pipeline {
    agent {
        node{
            label 'maven'
        }
    }
environment{
    PATH = "/opt/apache-maven-3.9.6/bin:$PATH"
}

    stages {
        stage("Build") {
            steps {
               sh 'mvn clean deploy' 
            }
        }
	stage('Building our image') {
           steps{
             script {
               dockerImage = docker.build registry + ":$BUILD_NUMBER"
           }
         }
       }
      stage('Deploy our image') {
       steps{
        script {
           withDockerRegistry(credentialsId: 'docker', toolName: 'Docker', url: 'https://hub.docker.com/') {
            dockerImage.push()
         }
      }
   }
 }  
      stage('Cleaning up') {
        steps{
          sh "docker rmi $registry:$BUILD_NUMBER"
        }
    } 
}
}
