def registry = 'https://hub.docker.com/'
def imageName = 'master101/docker/valaxyImage'
def version = '2.1.2'
pipeline {
    agent {
        node{
            label 'maven'
        }
    }
environment{
    PATH = "/opt/apache-maven-3.9.6/bin:$PATH"
}

    stages {
        stage("Build") {
            steps {
               sh 'mvn clean deploy' 
            }
        }
    stages {
        stage("Docker-Build") {
            steps {
              script{
                app = docker.build(imageName+":"+version)
              }
                
            }
        }
    stages {
        stage("Docker-publish") {
            script{
               docker.withRegistry(registry, 'docker')
                app.push()
              }
        }

    }
}
}
}
